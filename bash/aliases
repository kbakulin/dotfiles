# Reload the shell (i.e. invoke as a login shell)
alias reload="exec $SHELL -l"

alias ..='cd ..'
alias ...='cd ../..'

# Detect which `ls` flavor is in use
if ls --color > /dev/null 2>&1; then # GNU `ls`
    colorflag="--color"
else # OS X `ls`
    colorflag="-G"
fi
alias ls="command ls ${colorflag}"
alias sl='ls'
alias l='ls -lhT'
alias ll='ls -lha'

alias grep='grep -a --color=auto'
alias egrep='egrep -a --color=auto'
alias G='egrep'
alias GP='grep -P'

alias L='less'

alias tree='tree -a -I ".git|.svn|CVS|.DS_Store|*.pyc"'
alias tf='tail -f'

# Text editors
if ( __is_osx ); then
    alias m='subl'
    alias ge='gvim --remote-tab-silent'
else
    alias m='vim'
fi
alias e='vim'
alias ee='e .'
alias mm='m .'

# Git
alias g='git'
alias gg='git status -sb'
alias gd='git diff'
alias gdc='git diff --cached'
alias gl='git lg -30'
alias gll='git lg'
alias glp="git lp"
alias gco='git co'
alias gci='git ci'
alias gb='git b'
alias gba='git branch -avv'
alias gbm="git branch --no-merged"
alias gpl='git pl && git remote prune origin'
alias gps='git push'
alias gm="git m"
alias gmm="git mm"

alias gf="git flow feature"
alias gfs="git flow feature start"
alias gff="git flow feature finish"

alias git-new-workdir="/usr/local/share/git-core/contrib/workdir/git-new-workdir"
alias ungit="find . -name '.git' -exec rm -rf {} \;"

if which stree > /dev/null 2>&1; then
  alias gx='stree $(git rev-parse --show-toplevel)'
fi

if which tig > /dev/null 2>&1; then
  alias gt='tig .'
fi

# Python
alias p='python'
alias pp='ipython'
alias lssitepackages="lssitepackages -lh ${colorflag}"
alias rmpyc='find . -type f -iname "*.pyc" -delete'

function cl() {
    cd $1; l
}

function take() {
    mkdir -p "$1"
    cd "$1"
}

# Start ssh-agent and load key(s).
# May be useful when our key uses passphrase.
function ssh-agent-start() {
    # Start ssh-agent with bash shell
    eval $(ssh-agent -s)

    # Add key(s). Will ask for passphrase if needed
    for f in `ls ~/.ssh | grep -e "^id_[r|d]sa[^.]*$"`
    do
        ssh-add -k "~/.ssh/$f"
    done

    # Listing keys currently represented by the agent
    ssh-add -l
}


# Kill the current ssh-agent
function ssh-agent-stop() {
    ssh-agent -k
}

function c() {
    cd ~/code/$1;
}

function ce() {
    cd ~/code_ext/$1;
}

function d() {
    cd ~/Downloads/$1;
}

# Set the terminal's title
function title() {
    if [[ -n "${TMUX+set}" ]]; then
        tmux rename-window "$@"
    else
        case $TERM in
            *xterm*|ansi)
                echo -ne '\033]0;'"$@"'\a'
                ;;
        esac
    fi
}

# Set terminal's title to current dir name
function dirname-to-title() {
    title $(basename $(pwd))
}
alias dtitle="dirname-to-title"

#
# Mac OS X specific
#
if ( __is_osx ); then
    # Copy current dir path to system clipboard
    function pwdcopy() {
        pwd | tr -d '\n' | pbcopy
    }

    # Copy name of current dir to system clipboard
    function dirnamecopy() {
        basename $(pwd) | tr -d '\n' | pbcopy
    }

    # Open a manpage in Preview, which can be saved to PDF
    function pman() {
        man -t "${1}" | open -f -a "/Applications/Preview.app"
    }
fi


if which brew > /dev/null 2>&1; then
    function rpmunpack() {
        $(brew --cellar)/rpm2cpio/1.3/bin/rpm2cpio.pl $1 | cpio -ivd
    }
else
    function rpmunpack() {
        rpm2cpio $1 | cpio -ivd
    }
fi
